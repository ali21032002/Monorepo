# قابلیت‌های استنتاج و تحلیل احتمالات 🧠

## خلاصه ویژگی‌های جدید

سیستم LangExtract حالا قابلیت **استنتاج هوشمند** و **تحلیل احتمالات** را دارد. این قابلیت به جای صرف شناسایی موجودیت‌های مستقیم، می‌تواند **نتیجه‌گیری** و **احتمال‌سنجی** کند.

## مثال کاربردی 🎯

### متن مثال:
```
شخصی با هویت معلوم ؛ با نام که خودش گفته به اسم حسن جودت شندی 
وارد یک مغازه طلافروشی شده ، مقداری طلا را خریداری کرده ولی 
بدون پرداخت پول و بدون دریافت فاکتور از مغازه خارج شده است
```

### نتایج مورد انتظار:

#### موجودیت‌های شناسایی شده:
- `حسن جودت شندی` → **SUSPECT**
- `مغازه طلافروشی` → **LOCATION**  
- `طلا` → **PRODUCT**
- `خرید بدون پرداخت` → **SUSPICIOUS_BEHAVIOR**
- `احتمال سرقت` → **CRIMINAL_INFERENCE** ⭐

#### روابط استنتاج شده:
- `SUSPECT:حسن جودت شندی` --[PERFORMED]--> `SUSPICIOUS_BEHAVIOR:خرید بدون پرداخت`
- `SUSPICIOUS_BEHAVIOR:خرید بدون پرداخت` --[INDICATES]--> `CRIMINAL_INFERENCE:احتمال سرقت`

## Entity Types جدید 🏷️

### عمومی:
- **INFERENCE**: استنتاج‌های کلی
- **RISK_ASSESSMENT**: ارزیابی خطر

### حوزه پلیسی:
- **CRIMINAL_INFERENCE**: استنتاج‌های جرمی
- **SUSPICIOUS_BEHAVIOR**: رفتارهای مشکوک
- **THREAT_LEVEL**: سطح تهدید
- **MOTIVE**: انگیزه احتمالی

### حوزه حقوقی:
- **LEGAL_INFERENCE**: استنتاج‌های حقوقی
- **VIOLATION_RISK**: خطر نقض قانون

### حوزه پزشکی:
- **MEDICAL_INFERENCE**: استنتاج‌های پزشکی
- **HEALTH_RISK**: خطرات سلامتی

## Relationship Types جدید 🔗

- **INDICATES**: نشان می‌دهد / حاکی است از
- **SUGGESTS**: پیشنهاد می‌کند / احتمال دارد
- **IMPLIES**: به معنای / مستلزم
- **LEADS_TO**: منجر می‌شود به
- **CAUSES**: باعث می‌شود

## نحوه استفاده 🚀

### 1. تحلیل تک مدله
```python
from langextract import run_extraction

result = run_extraction(
    text="متن مشکوک...",
    language="fa",
    domain="police",  # مهم: حوزه پلیسی برای استنتاج بهتر
    model="gemma2:9b"
)

# جستجوی موجودیت‌های استنتاج
inference_entities = [
    e for e in result["entities"] 
    if e["type"] in ["CRIMINAL_INFERENCE", "SUSPICIOUS_BEHAVIOR"]
]
```

### 2. تحلیل چند مدله با داوری
```python
from langextract import run_multi_model_analysis

result = run_multi_model_analysis(
    text="متن مشکوک...",
    language="fa", 
    domain="police",
    model_first="gemma2:9b",
    model_second="llama3:8b",
    model_referee="llama3:8b"
)

# بررسی استنتاج‌های نهایی
final_inferences = [
    e for e in result["final_analysis"]["entities"]
    if "INFERENCE" in e["type"] or "SUSPICIOUS" in e["type"]
]
```

### 3. استفاده در API
```bash
curl -X POST /api/multi_extract \
  -H "Content-Type: application/json" \
  -d '{
    "text": "متن مشکوک...",
    "language": "fa",
    "domain": "police",
    "model_first": "gemma2:9b",
    "model_second": "llama3:8b", 
    "model_referee": "llama3:8b"
  }'
```

## بهبودهای Prompt ها 📝

### System Prompts:
- **عمومی**: "استنتاج‌های منطقی و احتمالات را ارزیابی کنید"
- **پلیسی**: "رفتارهای مشکوک، انگیزه‌های احتمالی، و سطح تهدید را تحلیل کنید"
- **حقوقی**: "احتمال نقض قوانین و خطرات حقوقی را ارزیابی کنید"
- **پزشکی**: "خطرات سلامتی و احتمالات تشخیصی را ارزیابی کنید"

### User Prompts:
- **پلیسی**: "اگر متن حاکی از احتمال جرم است، آن را به عنوان CRIMINAL_INFERENCE شناسایی کنید"

### Few-Shot Examples:
- مثال‌های تخصصی برای هر حوزه
- نمونه‌های استنتاج صحیح
- الگوهای تشخیص رفتار مشکوک

## تست سیستم 🧪

برای تست قابلیت‌های استنتاج:

```bash
python test_inference_system.py
```

این اسکریپت:
- ✅ تست prompt های استنتاج
- ✅ تست با متن مثال کاربر
- ✅ مقایسه نتایج حوزه‌های مختلف
- ✅ تست تک مدل و چند مدل (اختیاری)

## مثال‌های بیشتر 📋

### متن حقوقی:
```
آقای احمدی قرارداد را امضا کرد اما شرایط را نخواند و حالا معترض است.
```
**استنتاج**: `نقض احتمالی اصل آگاهانه بودن قرارداد` (LEGAL_INFERENCE)

### متن پزشکی:
```
بیمار 65 ساله با فشار خون بالا و دیابت، داروهایش را مصرف نمی‌کند.
```
**استنتاج**: `خطر حمله قلبی` (HEALTH_RISK)

### متن امنیتی:
```
فردی چندین بار در اطراف بانک دیده شده و عکس می‌گیرد.
```
**استنتاج**: `احتمال شناسایی برای سرقت` (CRIMINAL_INFERENCE)

## نکات مهم ⚠️

1. **انتخاب حوزه مناسب**: برای بهترین نتایج، حوزه صحیح را انتخاب کنید
2. **مدل‌های قوی**: مدل‌های بزرگ‌تر (7B+) نتایج بهتری دارند
3. **Temperature پایین**: برای استنتاج دقیق‌تر از temperature=0.1 استفاده کنید
4. **چند مدل**: برای موضوعات حساس از چند مدل + داور استفاده کنید

## آینده توسعه 🛣️

- [ ] حوزه‌های بیشتر (مالی، فنی، اجتماعی)
- [ ] سطح اطمینان برای هر استنتاج
- [ ] زنجیره استدلال (reasoning chain)
- [ ] تحلیل عاطفی و قصد
- [ ] تشخیص کذب و تناقض

---

**نتیجه**: سیستم حالا قادر است از متن "حسن جودت شندی احتمالاً دزدی کرده است" استنتاج کند! 🎉
